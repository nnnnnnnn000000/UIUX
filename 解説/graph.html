<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>グラフと三角関数 | 数学学習サイト</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f9ff;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #2a6ebb;
    }
    canvas {
      background: white;
      border: 1px solid #ccc;
    }
    .mode-buttons {
      margin: 20px;
    }
    .mode-buttons button {
      padding: 8px 16px;
      margin: 5px;
      border: 1px solid #2a6ebb;
      background: #e6f0ff;
      color: #2a6ebb;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }

    .angle-buttons {
      position: absolute;
      top: 0;
      left: 0;
      width: 400px;
      height: 400px;
      pointer-events: none; /* 吹き出し以外クリックが邪魔しないように */
    }

    .angle-buttons button {
      position: absolute;
      transform: translate(-50%, -50%);
      padding: 5px 8px;
      font-size: 12px;
      background: #dceeff;
      border: 1px solid #2a6ebb;
      border-radius: 4px;
      cursor: pointer;
      pointer-events: auto;
      z-index: 10;
    }

    .angle-buttons button.active-angle {
      background: #2a6ebb;
      color: white;
      font-weight: bold;
    }


    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      padding: 8px;
      border-radius: 6px;
      font-size: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      display: none;
      z-index: 10;
    }
    #toQuiz {
      display: inline-block;
      margin-top: 40px;
      background-color: #2a6ebb;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      text-decoration: none;
    }
    #toQuiz:hover {
      background-color: #1a4d8a;
    }
    .graph-section {
  padding: 40px 20px;
  max-width: 1000px;
  margin: auto;
}
.graph-section h2 {
  text-align: center;
  color: var(--main-color);
  margin-bottom: 30px;
}
.graph-container {
  display: flex;
  flex-direction: row;
  gap: 30px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}
.graph-img {
  width: 100%;
  max-width: 400px;
  height: auto;
}
.graph-description {
  list-style: none;
  padding-left: 0;
  font-size: 16px;
  max-width: 400px;
}
@media (max-width: 768px) {
  .graph-container {
    flex-direction: column;
  }
}

/* 三角関数の復習 */
.triangle-review {
  padding: 40px 20px;
  text-align: center;
}
.triangle-review h2 {
  color: var(--main-color);
  margin-bottom: 20px;
}
.full-img {
  width: 100%;
  max-width: 800px;
  margin: 10px 0;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* 単位円 */
.unit-circle {
  padding: 40px 20px;
  text-align: center;
}
.unit-circle h2 {
  color: var(--main-color);
}
.mode-buttons {
  margin-bottom: 20px;
}
.mode-buttons button {
  padding: 8px 16px;
  margin: 5px;
  background: #eef6ff;
  border: 1px solid #aaccee;
  color: #004488;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}
.mode-buttons button:hover {
  background-color: #d0eaff;
}

.mode-buttons button.active-mode {
  background-color: #2a6ebb;
  color: white;
}

canvas {
  border: 1px solid #ccc;
  margin-top: 20px;
  background: white;
  margin: 0;
}
.unit-wrapper {
  position: relative;
  width: 400px;
  height: 400px;
  margin: 0 auto;
}

/* ハンバーガーボタン */
.menu-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  background: #2a6ebb;
  color: white;
  font-size: 24px;
  padding: 10px 14px;
  border-radius: 6px;
  cursor: pointer;
  border: none;
}

/* パネル全体 */
.menu-panel {
  position: fixed;
  top: 0;
  right: 0;
  width: 260px;
  height: 100%;
  background: white;
  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  padding: 20px;
  display: none;
  flex-direction: column;
}

/* 単元リンク */
.menu-panel h3 {
  margin-bottom: 20px;
  font-size: 20px;
  color: #2a6ebb;
}
.menu-panel button {
  background: none;
  border: none;
  text-align: left;
  padding: 10px;
  font-size: 16px;
  color: #333;
  cursor: pointer;
}
.menu-panel button:hover {
  background: #eef6ff;
}

.question-link button {
  padding: 10px 20px;
  border: 2px solid #2a6ebb;       /* --main-color */
  background: white;                /* --mode-button-bg */
  color: #2a6ebb;                  /* --mode-button-text */
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.2s;
  margin-top: 40px;
  display: inline-block;
}

.question-link button:hover {
  background-color: #2a6ebb;
  color: white;
}

.back-button {
  position: fixed;
  top: 20px;     /* ← ここを top に */
  left: 20px;
  z-index: 1000;
}

.back-button button {
  padding: 10px 16px;
  font-size: 14px;
  background-color: white;
  border: 1px solid #2a6ebb;
  border-radius: 6px;
  cursor: pointer;
  color: #2a6ebb;
  font-weight: bold;
  box-shadow: 0 2px 6px white;
}

.back-button button:hover {
  background-color: #2a6ebb;
  color: white;
}

  </style>
</head>

<body>

  <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    <div class="menu-panel" id="menuPanel">
  <h3>単元を選ぶ</h3>
  <button onclick="showSection('graph')">グラフと三角関数</button>
  <button onclick="showSection('exp')">指数と対数</button>
  <button onclick="showSection('number')">数の定義</button>
  <button onclick="showSection('diff')">微分法の基礎</button>
  <button onclick="showSection('int')">積分法の基礎</button>
  <button onclick="showSection('calculus')">微分積分</button>
  <button onclick="showSection('vector')">ベクトルの基礎</button>
  <button onclick="showSection('matrix')">行列</button>
</div>


<div id="section-graph" class="section"></div>

    <!-- グラフの書き方 -->
<section class="graph-section">
  <h2>グラフの書き方</h2>
  <div class="graph-container">
    <img src="graph.png" alt="グラフの図" class="graph-img" />
    <ul class="graph-description">
      <li>① x軸、y軸、原点(O)を書く。</li>
      <li>② 関数の特徴を捉える。</li>
      <li>③ 点と点をつなげる。</li>
    </ul>
  </div>
</section>

<!-- 三角関数の復習 -->
<section class="triangle-review">
  <h2>三角関数の復習</h2>
  <img src="rot.png" alt="回転図" class="full-img" />
  <img src="rot_calculation.png" alt="三角関数の関係" class="full-img" />
</section>

<!-- 単位円 -->
<section class="unit-circle">

  <h2>単位円</h2>
  <div class="mode-buttons">
    <button onclick="setMode('deg')">度数法</button>
    <button onclick="setMode('rad')">弧度法</button>
  </div>

  <div class="unit-wrapper">
  <canvas id="unitCircle" width="400" height="400"></canvas>
  <div class="angle-buttons" id="angleButtons"></div>
  <div class="tooltip" id="tooltip"></div>
</div>
</section>

<script>
const canvas = document.getElementById("unitCircle");
const ctx = canvas.getContext("2d");
const centerX = 200;
const centerY = 200;
const radius = 140;
let mode = 'deg';

const trigMap = {
  0:   { sin: "0",     cos: "1",     tan: "0"     },
  30:  { sin: "1/2",   cos: "√3/2",  tan: "1/√3"  },
  45:  { sin: "√2/2",  cos: "√2/2",  tan: "1"     },
  60:  { sin: "√3/2",  cos: "1/2",   tan: "√3"    },
  90:  { sin: "1",     cos: "0",     tan: "∞"     },
  120: { sin: "√3/2",  cos: "-1/2",  tan: "-√3"   },
  135: { sin: "√2/2",  cos: "-√2/2", tan: "-1"    },
  150: { sin: "1/2",   cos: "-√3/2", tan: "-1/√3" },
  180: { sin: "0",     cos: "-1",    tan: "0"     },
  210: { sin: "-1/2",  cos: "-√3/2", tan: "1/√3"  },
  225: { sin: "-√2/2", cos: "-√2/2", tan: "1"     },
  240: { sin: "-√3/2", cos: "-1/2",  tan: "√3"    },
  270: { sin: "-1",    cos: "0",     tan: "∞"     },
  300: { sin: "-√3/2", cos: "1/2",   tan: "-√3"   },
  315: { sin: "-√2/2", cos: "√2/2",  tan: "-1"    },
  330: { sin: "-1/2",  cos: "√3/2",  tan: "-1/√3" },
};

const angles = [
  0, 30, 45, 60, 90, 120, 135, 150,
  180, 210, 225, 240, 270, 300, 315, 330
];

function setMode(m) {
  mode = m;
  createButtons();
  drawCircle();
  hideTooltip();

  const buttons = document.querySelectorAll(".mode-buttons button");
  buttons.forEach(btn => {
    if ((m === "deg" && btn.innerText.includes("度数")) ||
        (m === "rad" && btn.innerText.includes("弧度"))) {
      btn.classList.add("active-mode");
    } else {
      btn.classList.remove("active-mode");
    }
  });
}

function toRad(deg) {
  return deg * Math.PI / 180;
}

function formatAngle(angle) {
  if (mode === 'deg') return angle + "°";
  const map = {
    0: "0", 30: "\u03c0/6", 45: "\u03c0/4", 60: "\u03c0/3", 90: "\u03c0/2",
    120: "2\u03c0/3", 135: "3\u03c0/4", 150: "5\u03c0/6", 180: "\u03c0",
    210: "7\u03c0/6", 225: "5\u03c0/4", 240: "4\u03c0/3", 270: "3\u03c0/2",
    300: "5\u03c0/3", 315: "7\u03c0/4", 330: "11\u03c0/6"
  };
  return map[angle] || angle;
}

function drawCircle(selectedAngle = null) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
  ctx.strokeStyle = "#aaa";
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(centerX - radius - 10, centerY);
  ctx.lineTo(centerX + radius + 10, centerY);
  ctx.moveTo(centerX, centerY - radius - 10);
  ctx.lineTo(centerX, centerY + radius + 10);
  ctx.strokeStyle = "#ccc";
  ctx.stroke();

  if (selectedAngle !== null) {
    const rad = toRad(selectedAngle);
    const x = centerX + radius * Math.cos(rad);
    const y = centerY - radius * Math.sin(rad);

    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.lineTo(x, y);
    ctx.strokeStyle = "blue";
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(x, y, 5, 0, 2 * Math.PI);
    ctx.fillStyle = "blue";
    ctx.fill();
  }
}

let selectedAngle = null; // 現在選択中の角度
let activeButton = null;  // 現在選択中のボタン

function createButtons() {
  const container = document.getElementById("angleButtons");
  container.innerHTML = "";
  angles.forEach(angle => {
    const rad = toRad(angle);
    const x = centerX + radius * Math.cos(rad);
    const y = centerY - radius * Math.sin(rad);

    const btn = document.createElement("button");
    btn.style.left = `${x}px`;
    btn.style.top = `${y}px`;
    btn.innerText = formatAngle(angle);
    btn.onclick = () => toggleTooltip(angle, x, y, btn);
    container.appendChild(btn);
  });
}

function toggleTooltip(angle, x, y, btn) {
  // 同じ角度なら非選択にする（トグル）
  if (selectedAngle === angle) {
    hideTooltip();
    selectedAngle = null;
    if (activeButton) {
      activeButton.classList.remove("active-angle");
      activeButton = null;
    }
    drawCircle(); // 線も消す
    return;
  }

  // 違う角度なら前のボタンのアクティブを外す
  if (activeButton) activeButton.classList.remove("active-angle");

  // 新しいアクティブに変更
  selectedAngle = angle;
  activeButton = btn;
  activeButton.classList.add("active-angle");

  drawCircle(angle);
  const tooltip = document.getElementById("tooltip");

  const { sin, cos, tan } = trigMap[angle] || {
    sin: Math.round(Math.sin(toRad(angle)) * 100) / 100,
    cos: Math.round(Math.cos(toRad(angle)) * 100) / 100,
    tan: (Math.abs(Math.cos(toRad(angle))) < 0.01) ? '∞' :
         Math.round(Math.tan(toRad(angle)) * 100) / 100
  };

  tooltip.innerHTML = `
    <strong>${formatAngle(angle)}</strong><br>
    sin = ${sin}<br>
    cos = ${cos}<br>
    tan = ${tan}
  `;
  tooltip.style.left = `${x + 10}px`;
  tooltip.style.top = `${y - 30}px`;
  tooltip.style.display = 'block';
}

function showTooltip(angle, x, y) {
  drawCircle(angle);
  const tooltip = document.getElementById("tooltip");

  const { sin, cos, tan } = trigMap[angle] || {
    sin: Math.round(Math.sin(toRad(angle)) * 100) / 100,
    cos: Math.round(Math.cos(toRad(angle)) * 100) / 100,
    tan: (Math.abs(Math.cos(toRad(angle))) < 0.01) ? '∞' :
         Math.round(Math.tan(toRad(angle)) * 100) / 100
  };

  tooltip.innerHTML = `
    <strong>${formatAngle(angle)}</strong><br>
    sin = ${sin}<br>
    cos = ${cos}<br>
    tan = ${tan}
  `;
  tooltip.style.left = `${x + 10}px`;
  tooltip.style.top = `${y - 30}px`;
  tooltip.style.display = 'block';
}

function hideTooltip() {
  document.getElementById("tooltip").style.display = 'none';
}

setMode('deg'); // 初期表示

</script>

<div class="question-link">
  <button onclick="location.href='../問題/graph_quiz.html'">問題を解く</button>
</div>


<div id="section-exp" class="section" style="display:none;">
  <h2>指数と対数</h2>
  <p>ここに内容を書く</p>
</div>

<div id="section-number" class="section" style="display:none;">
  <h2>数の定義</h2>
  <p>ここに内容を書く</p>
</div>

<!-- 以下同様に diff, int, calculus, vector, matrix -->

<script>
function toggleMenu() {
  const menu = document.getElementById("menuPanel");
  menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
}

function showSection(key) {
  const allSections = document.querySelectorAll(".section");
  allSections.forEach(sec => sec.style.display = "none");

  const target = document.getElementById("section-" + key);
  if (target) target.style.display = "block";

  // メニューを自動で閉じる
  document.getElementById("menuPanel").style.display = "none";
}
</script>

<div class="back-button">
  <button onclick="history.back()">← 戻る</button>
</div>

</body>
</html>
